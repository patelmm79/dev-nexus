# Example Terraform Variables for dev-nexus
# Copy this file to terraform.tfvars and fill in your values

# ====================================
# REQUIRED: Basic Configuration
# ====================================

project_id = "your-gcp-project-id"
region     = "us-central1"

# GitHub token with repo access
# Get from: https://github.com/settings/tokens
# Required scopes: repo
github_token = "ghp_xxxxxxxxxxxxxxxxxxxxx"

# Anthropic API key
# Get from: https://console.anthropic.com
anthropic_api_key = "sk-ant-xxxxxxxxxxxxxxxxxxxxx"

# Knowledge base repository (format: owner/repo)
knowledge_base_repo = "your-username/dev-nexus"

# ====================================
# Cloud Run Configuration
# ====================================

# Resource allocation
cpu    = "1"      # Options: "1", "2", "4", "8"
memory = "1Gi"    # Examples: "512Mi", "1Gi", "2Gi", "4Gi"

# CPU always allocated (prevents cold starts but increases cost)
cpu_always_allocated = false

# Scaling configuration
min_instances = 0   # 0 = scale to zero (cost-effective)
max_instances = 10  # Maximum concurrent instances

# Request timeout (seconds, max 3600)
timeout_seconds = 300  # 5 minutes

# ====================================
# Security Configuration
# ====================================

# Allow unauthenticated access (NOT recommended for production)
# Set to false and use service accounts for production
allow_unauthenticated = false

# Service accounts allowed to authenticate (when allow_unauthenticated = false)
# Example:
# allowed_service_accounts = [
#   "log-attacker@your-project.iam.gserviceaccount.com",
#   "orchestrator@your-project.iam.gserviceaccount.com"
# ]
allowed_service_accounts = []

# Require authentication for write operations (add_deployment_info, add_lesson_learned, etc.)
# Set to false for development (all skills publicly accessible)
# Set to true for production (authenticated skills require auth headers)
require_auth_for_write = false

# Create service accounts for external agents
# Set to true to auto-create service accounts for log-attacker and orchestrator
create_external_service_accounts = false

# ====================================
# Integration Configuration (Optional)
# ====================================

# URL of dependency-orchestrator service
# Leave empty if not using orchestrator
orchestrator_url = ""
# Example: "https://dependency-orchestrator-xxxxx.run.app"

# URL of agentic-log-attacker service
# Leave empty if not using log-attacker
log_attacker_url = ""
# Example: "https://log-attacker-xxxxx.run.app"

# A regex to match allowed origins for CORS.
allowed_origin_regex = "https://.*-milan-patels-projects-187b35de\\.vercel\\.app"


# ====================================
# Monitoring Configuration (Optional)
# ====================================

# Enable Cloud Monitoring alerts
enable_monitoring_alerts = false

# Notification channels (create in Cloud Console first)
# Get channel IDs from: gcloud alpha monitoring channels list
alert_notification_channels = []
# Example:
# alert_notification_channels = [
#   "projects/your-project/notificationChannels/1234567890"
# ]

# Alert thresholds
error_rate_threshold  = 5.0    # Percentage (%)
latency_threshold_ms  = 5000   # Milliseconds

# ====================================
# Labels (Optional)
# ====================================

labels = {
  application = "dev-nexus"
  managed_by  = "terraform"
  environment = "production"
  team        = "platform"
}

# ====================================
# PostgreSQL Configuration
# ====================================

# PostgreSQL database password (REQUIRED - keep secure!)
postgres_db_password = "your-secure-password-here"

# Database configuration
postgres_db_name = "devnexus"
postgres_db_user = "devnexus"

# PostgreSQL version (14, 15, or 16)
postgres_version = "15"

# VM configuration (e2-micro is FREE tier eligible!)
postgres_machine_type = "e2-micro"  # Options: e2-micro (FREE), e2-small, e2-medium, n1-standard-1

# Disk size (30 GB is free tier eligible)
postgres_disk_size_gb = 30

# Network configuration
postgres_subnet_cidr = "10.8.0.0/24"
vpc_connector_cidr   = "10.8.1.0/28"  # Must be /28 for VPC connector

# SSH access (IMPORTANT: Restrict in production!)
# For production, use: ["YOUR_IP/32"]
# For development, can use: ["0.0.0.0/0"]
allow_ssh_from_cidrs = ["0.0.0.0/0"]

# Backup retention (days)
backup_retention_days = 30

# Enable monitoring for PostgreSQL
enable_postgres_monitoring = true

# ====================================
# Example Configurations
# ====================================

# Development Environment:
# - allow_unauthenticated = true
# - require_auth_for_write = false (all skills public)
# - min_instances = 0
# - cpu = "1", memory = "1Gi"
# - postgres_machine_type = "e2-micro" (FREE!)

# Staging Environment:
# - allow_unauthenticated = false
# - require_auth_for_write = true (skills require auth)
# - min_instances = 0
# - cpu = "1", memory = "2Gi"
# - create_external_service_accounts = true
# - postgres_machine_type = "e2-micro"

# Production Environment:
# - allow_unauthenticated = false
# - require_auth_for_write = true (skills require auth)
# - min_instances = 1 (no cold starts)
# - cpu = "2", memory = "2Gi"
# - cpu_always_allocated = true
# - enable_monitoring_alerts = true
# - create_external_service_accounts = true
# - postgres_machine_type = "e2-small" or "e2-medium"
# - allow_ssh_from_cidrs = ["YOUR_OFFICE_IP/32"]

# ====================================
# Cost Optimization Notes
# ====================================

# FREE Tier Configuration (â‰ˆ$0/month):
# - postgres_machine_type = "e2-micro" (1 vCPU, 1GB RAM)
# - postgres_disk_size_gb = 30 (standard persistent disk)
# - region = "us-west1", "us-central1", or "us-east1"
# - Cloud Run: min_instances = 0 (scale to zero)
#
# This configuration uses GCP Always Free tier:
# - 1 e2-micro instance per month
# - 30 GB standard persistent disk
# - Cloud Run free tier (2M requests/month)
#
# Expected cost: $0-5/month
